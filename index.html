<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>å‘¨æ°å€« ä½œå“å±•ç¤º â€” å°ˆæ¥­å¼·åŒ–ç‰ˆï¼ˆå–®æª”ï¼‰</title>

    <style>
        /* ---------- æ ¹è‰²å½©èˆ‡åŸºç¤ ---------- */
        :root {
            --bg: #071029;
            --bg2: #001219;
            --card: #0f172a;
            --text: #e6eef8;
            --muted: #a9c0ff;
            --accent1: #1f6feb;
            --accent2: #8b5cf6;
            --glass: rgba(255, 255, 255, 0.04);
            --glass-2: rgba(255, 255, 255, 0.03);
        }

        [data-theme="light"] {
            --bg: #f5f7fb;
            --bg2: #e9eef9;
            --card: #fff;
            --text: #0b1b2b;
            --muted: #375a9b;
            --accent1: #2563eb;
            --accent2: #7c3aed;
            --glass: rgba(2, 6, 23, 0.03);
        }

        * {
            box-sizing: border-box
        }

        html,
        body {
            height: 100%;
            margin: 0;
            font-family: "Noto Sans TC", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            background: radial-gradient(ellipse at top left, var(--bg) 0%, var(--bg2) 100%);
            color: var(--text);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Header / nav */
        .header {
            position: sticky;
            top: 0;
            z-index: 80;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.06));
            backdrop-filter: blur(6px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.03)
        }

        .nav {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 12px
        }

        .brand {
            font-weight: 800;
            font-size: 18px
        }

        .nav-links {
            display: flex;
            gap: 10px;
            margin-left: 12px
        }

        .nav-links a {
            color: var(--muted);
            text-decoration: none;
            padding: 8px;
            border-radius: 8px
        }

        .nav-links a:hover {
            background: var(--glass);
            color: var(--text)
        }

        .actions {
            margin-left: auto;
            display: flex;
            gap: 8px;
            align-items: center
        }

        /* Buttons */
        .btn {
            padding: 8px 12px;
            border-radius: 10px;
            border: none;
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            color: white;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2)
        }

        .icon-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.06);
            padding: 8px;
            border-radius: 10px;
            color: var(--muted);
            cursor: pointer
        }

        /* ä¿®æ­£ç‰ˆï¼šæŒ‰éˆ•æ¸…å–® */
        .simple-btn-container {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 15px
        }

        .simple-btn {
            display: inline-block;
            text-decoration: none;
            color: white;
            font-weight: 600;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            transition: all .2s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4)
        }

        .simple-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.45)
        }

        .simple-list-row {
            width: 100%;
            display: flex;
            gap: 12px
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 28px auto;
            padding: 0 20px
        }

        .grid {
            display: grid;
            grid-template-columns: 340px 1fr;
            gap: 24px;
            align-items: start
        }

        .card {
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.02), rgba(255, 255, 255, 0.01));
            border-radius: 14px;
            padding: 18px;
            border: 1px solid var(--glass);
            box-shadow: 0 12px 40px rgba(2, 6, 23, 0.45)
        }

        .cover {
            width: 100%;
            height: 360px;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.04)
        }

        .cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block
        }

        /* Song list */
        .song-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-height: 64vh;
            overflow: auto;
            padding-right: 6px
        }

        .song-item {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 8px;
            border-radius: 10px;
            cursor: pointer;
            opacity: 0;
            transform: translateY(6px);
            transition: all .28s cubic-bezier(.2, .9, .2, 1)
        }

        .song-item.visible {
            opacity: 1;
            transform: none
        }

        .song-item:hover {
            background: var(--glass)
        }

        .song-item.active {
            background: linear-gradient(90deg, var(--accent1), var(--accent2));
            color: white;
            box-shadow: 0 8px 24px rgba(31, 111, 235, 0.12)
        }

        /* Article */
        .article h2 {
            font-size: 20px;
            margin-bottom: 10px
        }

        .article p {
            line-height: 1.8;
            color: var(--text)
        }

        /* Profile */
        .jay-profile {
            padding: 18px;
            display: grid;
            grid-template-columns: 160px 1fr;
            gap: 16px;
            border-radius: 12px;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.01), rgba(255, 255, 255, 0.005));
            border: 1px solid var(--glass);
            margin-bottom: 18px
        }

        .jay-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px
        }

        /* Footer notes */
        .footer-note {
            color: var(--muted);
            text-align: center;
            margin-top: 12px
        }

        /* Play overlay (å¤§æŒ‰éˆ•) */
        .play-overlay {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, rgba(2, 6, 23, 0.65), rgba(2, 6, 23, 0.85));
            z-index: 120;
            backdrop-filter: blur(6px)
        }

        .play-overlay .card {
            max-width: 760px;
            text-align: center
        }

        .play-overlay button {
            font-size: 20px;
            padding: 14px 22px;
            border-radius: 12px
        }

        /* Typewriter for description */
        .typewriter {
            white-space: pre-wrap;
            overflow: hidden;
            border-right: .12em solid rgba(255, 255, 255, 0.12);
            animation: caret 1s steps(1) infinite;
        }

        @keyframes caret {
            50% {
                border-color: transparent
            }
        }

        /* Fade-in elements */
        .fade-in {
            opacity: 0;
            transform: translateY(8px);
            transition: all .5s ease;
        }

        .fade-in.show {
            opacity: 1;
            transform: none;
        }

        /* Responsive */
        @media(max-width:980px) {
            .grid {
                grid-template-columns: 1fr
            }

            .cover {
                height: 240px
            }

            .jay-profile {
                grid-template-columns: 1fr
            }

            .song-list {
                flex-direction: row;
                overflow: auto;
                padding-bottom: 8px
            }

            .song-item {
                min-width: 220px
            }
        }
    </style>
</head>

<body>

    <header class="header">
        <nav class="nav">
            <div class="brand">å‘¨æ°å€« ä½œå“å±•ç¤ºï¼ˆå°ˆæ¥­å¼·åŒ–ï¼‰</div>
            <div class="nav-links">
                <a href="#profile">é—œæ–¼</a>
                <a href="#songs">ä½œå“</a>
                <a href="#about">é—œæ–¼æ­¤ç«™</a>
            </div>
            <div class="actions">
                <button id="themeBtn" class="icon-btn" title="åˆ‡æ›ä¸»é¡Œ">ğŸŒ™</button>
                <button id="openImport" class="icon-btn" title="åŒ¯å…¥æ­Œå–®">ğŸ“¥ åŒ¯å…¥</button>
                <button id="downloadSite" class="btn" title="ä¸‹è¼‰æ•´ç«™">ä¸‹è¼‰ç«™å°</button>
            </div>
        </nav>
    </header>

    <main class="container">
        <!-- Profile -->
        <section id="profile" class="card jay-profile fade-in">
            <div class="jay-photo"><img
                    src="https://tse1.mm.bing.net/th/id/OIP.4dG9OVq-SXLG3WuRVH0y0gHaHa?rs=1&pid=ImgDetMain&o=7&rm=3&adlt=strict.jpeg"
                    alt="å‘¨æ°å€«"></div>
            <div>
                <h1 style="margin:0 0 6px 0">å‘¨æ°å€« Â· Jay Chou</h1>
                <p style="margin:0 0 10px;color:var(--muted)">å‰µä½œæ­Œæ‰‹ Â· è£½ä½œäºº Â· å°æ¼” Â· è¯èªæµè¡Œæ–‡åŒ–çš„é¢¨æ ¼ç· é€ è€…</p>
                <div class="kv"><b>å‡ºç”Ÿ</b><span>1979-01-18ï¼ˆå°åŒ—ï¼‰</span></div>
                <div class="kv"><b>å°ˆé•·</b><span>ä½œæ›²ã€ç·¨æ›²ã€é‹¼ç´ã€è£½ä½œã€å°æ¼”</span></div>
                <div class="kv"><b>å‡ºé“</b><span>2000ã€ŠJayã€‹</span></div>

                <h3 style="margin-top:12px">ä»£è¡¨æˆå°±</h3>
                <ul style="margin-top:8px;color:var(--text);line-height:1.7">
                    <li>å‰µæ–°èåˆä¸­è¥¿éŸ³æ¨‚èªå½™ï¼Œå»ºç«‹ã€Œå‘¨æ°é¢¨æ ¼ã€ã€‚</li>
                    <li>è·¨ç•Œé›»å½±å°æ¼”èˆ‡æ¼”å‡ºï¼Œä½œå“å…·æœ‰å¼·çƒˆç•«é¢æ„Ÿã€‚</li>
                    <li>å½±éŸ¿æ•´æ•´ä¸€ä»£äººçš„é’æ˜¥èˆ‡æµè¡Œæ–‡åŒ–é¢¨è²Œã€‚</li>
                </ul>
            </div>
        </section>

        <!-- Main grid -->
        <section id="songs" class="grid">
            <!-- å·¦å´ï¼šæ¸…å–® -->
            <div class="card fade-in" style="transition-delay:.05s">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                    <div><strong>ä½œå“æ¸…å–®</strong>
                        <div class="small">é»é¸æˆ–ç”¨å·¦å³éµåˆ‡æ­Œ</div>
                    </div>
                    <div class="small">æ”¯æ´åŒ¯å…¥ JSON / CSV</div>
                </div>

                <div class="song-list" id="songList" role="list" aria-label="ä½œå“æ¸…å–®"></div>

                <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
                    <input id="importInput" type="file" accept=".json,.csv" style="display:none" />
                    <button id="importBtn" class="icon-btn">ğŸ“ åŒ¯å…¥</button>
                    <button id="addSampleBtn" class="icon-btn">â• åŠ å…¥æ›´å¤šç¯„ä¾‹</button>
                    <button id="clearBtn" class="icon-btn">ğŸ—‘ æ¸…é™¤æ­Œå–®</button>
                </div>

                <div style="margin-top:12px;font-size:13px;color:var(--muted)">
                    ä½ ä¹Ÿå¯ä»¥æŠŠæ•´å€‹æ­Œå–®åŒ¯å‡ºæˆ JSONï¼ˆå³ä¸Šã€Œä¸‹è¼‰ç«™å°ã€æœƒåŒ…æ•´é ï¼‰ã€‚
                </div>
            </div>

            <!-- å³å´ï¼šé¡¯ç¤º -->
            <div class="card fade-in" style="transition-delay:.1s">
                <div class="cover" id="coverDisplay"><img id="coverImg" src="" alt="cover"></div>

                <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
                    <div>
                        <h2 id="songTitle" style="margin:0">â€”</h2>
                        <div id="songTags" style="margin-top:6px;color:var(--muted)"></div>
                    </div>
                    <div style="display:flex;gap:8px;align-items:center">
                        <button id="prevBtn" class="icon-btn" title="ä¸Šä¸€é¦–">â—€</button>
                        <button id="playToggle" class="btn" title="æ’­æ”¾ / æš«åœ">æ’­æ”¾</button>
                        <button id="nextBtn" class="icon-btn" title="ä¸‹ä¸€é¦–">â–¶</button>
                    </div>
                </div>

                <article class="article" id="songArticle" style="margin-top:14px">
                    <h2>ä½œå“ä»‹ç´¹</h2>
                    <p id="songDesc" class="typewriter">è«‹å¾å·¦å´é¸æ“‡ä¸€é¦–æ­Œæ›²ï¼Œæˆ–åŒ¯å…¥ä½ çš„å®Œæ•´æ­Œå–®ã€‚</p>

                    <h2 style="margin-top:18px">è§€çœ‹ MVï¼ˆåŒæ­¥éŸ³è¨Šï¼‰</h2>
                    <div style="position:relative;padding-top:56.25%;margin-top:8px">
                        <div id="mvWrapper"
                            style="position:absolute;inset:0;border-radius:8px;overflow:hidden;background:#000">
                            <div id="mvPlayerContainer" style="width:100%;height:100%;background:#000"></div>
                        </div>
                    </div>

                    <div style="margin-top:10px;display:flex;gap:10px;align-items:center">
                        <label class="small" style="margin-right:6px">è‡ªå‹•æ’­æ”¾ MV éŸ³é‡ï¼š</label>
                        <input id="mvVolume" type="range" min="0" max="1" step="0.01" value="0.75" />
                        <label class="small">èƒŒæ™¯éŸ³æ¨‚éŸ³é‡ï¼š</label>
                        <input id="bgVolume" type="range" min="0" max="1" step="0.01" value="0.9" />
                    </div>
                </article>
            </div>

            <!-- ä¸‹æ–¹ï¼šå¤–éƒ¨é€£çµæŒ‰éˆ• -->
            <section style="margin-bottom: 28px;">
                <h2 style="margin-top:0;margin-bottom: 20px;">å¿«é€Ÿ YouTube é€£çµ</h2>
                <div class="simple-btn-container">
                    <a href="https://www.youtube.com/watch?v=3da0K8wH4Ns" class="simple-btn" target="_blank">é’èŠ±ç“·ï¼ˆYTï¼‰</a>
                    <a href="https://www.youtube.com/watch?v=3da0K8wH4Ns" class="simple-btn" target="_blank">ä¸ƒé‡Œé¦™ï¼ˆYTï¼‰</a>
                    <div class="simple-list-row"><a href="https://www.youtube.com/watch?v=4v6bR0wTqTc"
                            class="simple-btn" target="_blank">ä¸èƒ½èªªçš„ç§˜å¯†ï¼ˆYTï¼‰</a></div>
                    <a href="https://www.youtube.com/watch?v=6hD9kYy1r1g" class="simple-btn" target="_blank">å¤œæ›²ï¼ˆYTï¼‰</a>
                    <a href="https://www.youtube.com/watch?v=0zsc3wD2W-k" class="simple-btn" target="_blank">ç¨»é¦™ï¼ˆYTï¼‰</a>
                    <a href="https://www.youtube.com/watch?v=mRyq-6XMSSQ" class="simple-btn" target="_blank">æ™´å¤©ï¼ˆYTï¼‰</a>
                </div>
            </section>

            <!-- é—œæ–¼æ­¤ç«™ -->
            <section id="about" class="card fade-in" style="margin-top:22px">
                <h2>é—œæ–¼æ­¤ç«™</h2>
                <p>é€™æ˜¯ä¸€å€‹ç¤ºç¯„å‹çš„å–®æª”ä½œå“å±•ç¤ºé é¢ï¼Œæ”¯æ´ä¸€æ¬¡åŒ¯å…¥å¤§é‡æ­Œå–®ã€æ’­æ”¾èƒŒæ™¯éŸ³æ¨‚ã€åµŒå…¥ MV ä¸¦æ§åˆ¶éŸ³é‡ã€‚<br>
                    å¦‚æœç€è¦½å™¨é˜»æ“‹è‡ªå‹•æ’­æ”¾ï¼Œè«‹æŒ‰é é¢ä¸­å¤®çš„å¤§æ’­æ”¾éµä»¥å•Ÿå‹•è²éŸ³èˆ‡ MVï¼ˆåƒ…éœ€ä¸€æ¬¡äº’å‹•ï¼‰ã€‚</p>
                <p class="small">å‚™è¨»ï¼šæœ¬ç«™ç¤ºç¯„çš„éŸ³è¨Šæª”èˆ‡ MV å¤šç‚ºå¤–éƒ¨é€£çµï¼›è«‹åœ¨éµå®ˆç‰ˆæ¬Šä¸‹ä½¿ç”¨ã€‚è‹¥æœ‰æ­£è¦æª”æ¡ˆï¼ˆmp3ï¼‰ï¼Œå¯åœ¨ songs è³‡æ–™ä¸­æŒ‡å®š audio å±¬æ€§ä»¥é”åˆ°æ›´ä½³åŒæ­¥èˆ‡éŸ³è³ªã€‚</p>
            </section>

            <!-- æ„Ÿæƒ³ï¼ˆå·²å‡ç´šï¼‰ -->
            <div class="footer-note fade-in" style="margin-top:18px">
                <h2>æ„Ÿæƒ³ / å•Ÿç™¼</h2>
                <p style="max-width:900px;margin:8px auto 0;color:var(--muted);line-height:1.7">
                    å‘¨æ°å€«çš„æˆé•·èˆ‡å‰µä½œæ­·ç¨‹å‘Šè¨´æˆ‘å€‘ï¼šä¸æ˜¯æ¯å€‹äººåœ¨æ¨™æº–åŒ–æ¸¬é©—ä¸­éƒ½æœƒç™¼å…‰ï¼Œä½†åœ¨åˆé©çš„èˆå°èˆ‡ç†±æƒ…å‰ï¼Œä»»ä½•äººéƒ½æœ‰å¯èƒ½ç¶»æ”¾ã€‚å°ˆæ³¨ã€å¯¦é©—ä»¥åŠè·¨æ–‡åŒ–çš„å‹‡æ°£ï¼Œä½¿ä»–èƒ½æŠŠæ±æ–¹æ–‡å­¸æ„Ÿèˆ‡ç¾ä»£æµè¡Œç¯€æ‹ç·¨ç¹”æˆä»¤äººé›£å¿˜çš„éŸ³æ¨‚è¨˜æ†¶ã€‚é€™ä»½å‹‡æ°£ï¼Œå€¼å¾—æ¯ä¸€ä½å‰µä½œè€…å­¸ç¿’ã€‚
                </p>
            </div>

        </section>
    </main>

    <!-- Play overlayï¼ˆç•¶è‡ªå‹•æ’­æ”¾è¢«é˜»æ“‹æ™‚é¡¯ç¤ºï¼‰ -->
    <div id="playOverlay" class="play-overlay" style="display:none">
        <div class="card">
            <h2>é–‹å§‹æ’­æ”¾ â€” å•Ÿå‹•éŸ³æ¨‚èˆ‡ MV</h2>
            <p class="small" style="color:var(--muted);max-width:720px;margin:8px auto 14px">
                ç€è¦½å™¨å¯èƒ½æœƒé˜»æ“‹æœªäº’å‹•çš„è‡ªå‹•æ’­æ”¾ã€‚æŒ‰ä¸‹ä¸‹æ–¹æŒ‰éˆ•ä»¥å•Ÿå‹•èƒŒæ™¯éŸ³æ¨‚èˆ‡åµŒå…¥ MV çš„è²éŸ³ã€‚</p>
            <button id="startAll" class="btn">â–¶ é–‹å§‹æ’­æ”¾</button>
            <div style="margin-top:12px">
                <button id="dismissOverlay" class="icon-btn">ç¨å¾Œå†èªª</button>
            </div>
        </div>
    </div>

    <footer style="padding:18px;text-align:center;color:var(--muted)">
        <div style="max-width:1100px;margin:0 auto">æ­¤æª”æ¡ˆç‚ºç¤ºç¯„ã€‚è‹¥è¦åŒ¯å‡ºå…§å®¹æˆ–åŠ å…¥è‡ªå·±çš„éŸ³è¨Šæª”ï¼Œè«‹ç”¨åŒ¯å…¥åŠŸèƒ½æˆ–ç›´æ¥ç·¨è¼¯ songs é™£åˆ—ã€‚</div>
    </footer>

    <!-- ---------------- JS é‚è¼¯ï¼ˆæ­Œå–®ã€å¤šå°ˆè¼¯ã€å‹•ç•«ã€æ’­æ”¾ï¼‰ ---------------- -->
    <script>
        /* ========= è³‡æ–™ï¼šå¤šå°ˆè¼¯ã€å¤šæ­Œæ›²ï¼ˆç¤ºä¾‹è³‡æ–™ï¼Œdesc ç‚ºé•·ç¯‡ï¼‰ ========= */
        const albums = [
            {
                id: 'album_classics',
                title: 'ç¶“å…¸ä»£è¡¨ä½œ',
                year: '2000-2010',
                songs: [
                    {
                        id: 'qihuaci',
                        title: 'é’èŠ±ç“·',
                        cover: 'https://i.ytimg.com/vi/z6ZN1F4G5WY/maxresdefault.jpg',
                        tags: 'ä¸­åœ‹é¢¨ Â· 2007',
                        audio: 'https://cdn.simple-music.net/example/audio/qihuaci.mp3', // ç¯„ä¾‹ï¼šè‹¥ä½ æœ‰ mp3 å¯æ›¿æ›
                        mv: 'https://www.youtube.com/embed/3da0K8wH4Ns',
                        desc: `ã€Šé’èŠ±ç“·ã€‹ä»¥æ±æ–¹å¤å…¸çš„ç•«æ„ç‚ºæ ¸å¿ƒï¼Œåƒä¸€æ²åœ¨è€³é‚Šç·©ç·©å±•é–‹çš„æ°´å¢¨ç•«ã€‚å‘¨æ°å€«ç”¨ç´°è†©çš„æ—‹å¾‹æ“˜ç•«å‡ºé’ç™½ç“·çš„ç´‹ç†èˆ‡éš±è—å…¶ä¸­çš„æƒ…æ„Ÿï¼Œæ–¹æ–‡å±±çš„è©å‰‡ç”¨æ¯›ç­†èˆ¬çš„æ„è±¡å‹¾å‹’å‡ºé›¨å··ã€æœˆè‰²èˆ‡æ†¶å¿µã€‚ç·¨æ›²ä¸Šä»¥å¤ç®ã€çµç¶èˆ‡å¼¦æ¨‚ç›¸è¥¯ï¼Œè®“æ•´é¦–æ­Œåœ¨æµè¡Œç¯€æ‹ä¸­åŒæ™‚ä¿æœ‰å¤å…¸çš„å†·å†½ç¾æ„Ÿï¼Œæˆç‚ºã€Œä¸­åœ‹é¢¨ã€åœ¨å•†æ¥­æµè¡Œæ¨‚å ´æ™¯ä¸­çš„ä»£è¡¨æ€§ä½œå“ä¹‹ä¸€ã€‚`
                    },
                    {
                        id: 'qing-tian',
                        title: 'æ™´å¤©',
                        cover: 'https://i.ytimg.com/vi/mRyq-6XMSSQ/hqdefault.jpg',
                        tags: 'æŠ’æƒ… Â· 2003',
                        audio: 'https://cdn.simple-music.net/example/audio/qingtian.mp3',
                        mv: 'https://www.youtube.com/embed/mRyq-6XMSSQ',
                        desc: `ã€Šæ™´å¤©ã€‹ä»¥ç°¡æ½”è€Œæº«æš–çš„æ—‹å¾‹ï¼Œæè¿°æ„›æƒ…å›æ†¶èˆ‡å¿ƒéˆå¾®å…‰ã€‚å®ƒçš„æ—‹å¾‹æœ—æœ—ä¸Šå£ï¼Œæ­Œè©ä»¥æ—¥å¸¸æ„è±¡åˆ‡å…¥ï¼Œç”¨æœ€ç´”ç²¹çš„æƒ…æ„ŸæŠ•å°„å‡ºä¸€ç¨®å¯å›æº¯çš„é’æ˜¥è¨˜æ†¶ï¼Œä½¿å¾—å®ƒæˆç‚ºè¨±å¤šäººæ‡·å¿µé’æ˜¥èˆ‡æ„›æƒ…çš„æƒ…æ„Ÿå‡ºå£ã€‚`
                    },
                    {
                        id: 'qingxiang',
                        title: 'ç¨»é¦™',
                        cover: 'https://img.pconline.com.cn/images/upload/upc/tx/photoblog/1908/08/c4/163480953_1565247824655_mthumb.jpg',
                        tags: 'é„‰æ‘ / å‹µå¿— Â· 2008',
                        audio: 'https://cdn.simple-music.net/example/audio/daoxiang.mp3',
                        mv: 'https://www.youtube.com/embed/0zsc3wD2W-k',
                        desc: `ã€Šç¨»é¦™ã€‹å›åˆ°æœ€æ¨¸å¯¦çš„è¨˜æ†¶ï¼šç”°é‡ã€ç«¥å¹´èˆ‡å®¶åº­ã€‚å‘¨æ°å€«ç”¨è¼•å¿«çš„ç¯€å¥å’Œæº«æš–çš„ç·¨æ›²ï¼Œå‚³é”å°ç•¶ä¸‹çš„å¯¬æ…°èˆ‡å°ç´”çœŸç”Ÿæ´»çš„æ‡·å¿µï¼›å®ƒåŒæ™‚ä¹Ÿæ˜¯ä¸€é¦–å‹µå¿—æ›²ï¼Œæé†’æˆ‘å€‘åˆ¥å¿˜äº†æ ¹èˆ‡åˆå¿ƒã€‚`
                    },
                    {
                        id: 'shuang-jiegun',
                        title: 'é›™æˆªæ£',
                        cover: 'https://i.ytimg.com/vi/DYh8nKQzL5U/maxresdefault.jpg',
                        tags: 'å˜»å“ˆ Â· 2001',
                        audio: '',
                        mv: 'https://www.youtube.com/embed/qqgC0xZ3J1w',
                        desc: `ã€Šé›™æˆªæ£ã€‹å°‡æ­¦è¡“ç¯€å¥èˆ‡å˜»å“ˆç¯€æ‹çµåˆï¼Œæ˜¯å‘¨æ°å€«å°‡æ±æ–¹æ­¦è¡“æ–‡åŒ–èå…¥æµè¡ŒéŸ³æ¨‚çš„æ—©æœŸä»£è¡¨ã€‚å¼·çƒˆç¯€å¥èˆ‡å£èªåŒ–çš„æŠ¼éŸ»ï¼Œä½¿æ­Œæ›²å……æ»¿åŠ›é‡èˆ‡è¡—é ­æ„Ÿã€‚`
                    }
                ]
            },
            {
                id: 'album_romance',
                title: 'æµªæ¼«æŠ’æƒ…',
                year: '2002-2010',
                songs: [
                    {
                        id: 'cantell',
                        title: 'ä¸èƒ½èªªçš„ç§˜å¯†',
                        cover: 'https://tse3.mm.bing.net/th/id/OIP.9nv2hJEEG3glmddXxeT52QHaHa?rs=1&pid=ImgDetMain&o=7&rm=3&adlt=strict.jpg',
                        tags: 'é›»å½±ä¸»é¡Œæ›² Â· 2007',
                        audio: 'https://cdn.simple-music.net/example/audio/cantell.mp3',
                        mv: 'https://www.youtube.com/embed/4v6bR0wTqTc',
                        desc: `ä½œç‚ºåŒåé›»å½±çš„ä¸»é¡Œæ›²ï¼Œã€Šä¸èƒ½èªªçš„ç§˜å¯†ã€‹ä»¥é‹¼ç´ç‚ºæ ¸å¿ƒï¼Œç·¨ç¹”å‡ºç©¿è¶Šæ™‚é–“çš„æ„›æƒ…å¯“è¨€ã€‚æ—‹å¾‹æ—¢å¸¶æœ‰æ·¡æ·¡çš„å“€æ„ï¼Œåˆèƒ½åœ¨é—œéµæ™‚åˆ»çˆ†ç™¼æƒ…æ„Ÿå¼µåŠ›ï¼Œè®“äººè†è½æ™‚è±¡å¾µè‘—ä¸€æ®µè·¨è¶Šèˆ‡éºæ†¾çš„é’æ˜¥ã€‚`
                    },
                    {
                        id: 'yequ',
                        title: 'å¤œæ›²',
                        cover: 'https://tse4.mm.bing.net/th/id/OIP.GKvk0j3MoURNqsmLzVHCdgHaFf?rs=1&pid=ImgDetMain&o=7&rm=3&adlt=strict.jpg',
                        tags: 'å¤å…¸æ–æ»¾ Â· 2005',
                        audio: '',
                        mv: 'https://www.youtube.com/embed/6hD9kYy1r1g',
                        desc: `ã€Šå¤œæ›²ã€‹å¸¶æœ‰é»‘è‰²æ•˜äº‹èˆ‡æˆ²åŠ‡å¼µåŠ›ï¼Œå°‡æ‚¼å¿µèˆ‡æ„›æƒ…äº¤ç¹”æˆä¸€é¦–å¦‚é›»å½±èˆ¬çš„æƒ…æ­Œã€‚å¤å…¸å¼¦æ¨‚èˆ‡ç¾ä»£ç¯€å¥èåˆï¼Œç‡Ÿé€ å‡ºæ¿ƒåšçš„æƒ…ç·’ç©ºé–“ã€‚`
                    }
                ]
            },
            {
                id: 'album_modern',
                title: 'å¯¦é©—èˆ‡å˜—è©¦',
                year: '2010-2020',
                songs: [
                    {
                        id: 'modern_1',
                        title: 'ç¤ºç¯„æ–°æ›² A',
                        cover: 'https://picsum.photos/seed/jayA/800/500',
                        tags: 'å¯¦é©— Â· 2015',
                        audio: '',
                        mv: '',
                        desc: `ç¤ºç¯„æ›²ç›®ï¼Œç”¨ä¾†å±•ç¤ºå¤šé¦–å¤§é‡åŒ¯å…¥çš„æƒ…æ³èˆ‡ RWD é¡¯ç¤ºã€‚`
                    },
                    // æ›´å¤šå¯åœ¨æ­¤åŠ å…¥
                ]
            }
        ];

        // flatten songs toä¸€å€‹é™£åˆ—ï¼ˆæ–¹ä¾¿ list èˆ‡åˆ‡æ­Œï¼‰
        let songs = [];
        albums.forEach(al => al.songs.forEach(s => songs.push({ ...s, albumTitle: al.title, albumYear: al.year })));

        /* ======= DOM refs ======= */
        const songListEl = document.getElementById('songList');
        const coverImg = document.getElementById('coverImg');
        const songTitle = document.getElementById('songTitle');
        const songTags = document.getElementById('songTags');
        const songDesc = document.getElementById('songDesc');

        const mvPlayerContainer = document.getElementById('mvPlayerContainer');
        const mvVolumeEl = document.getElementById('mvVolume');
        const bgVolumeEl = document.getElementById('bgVolume');

        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const playToggle = document.getElementById('playToggle');

        const playOverlay = document.getElementById('playOverlay');
        const startAll = document.getElementById('startAll');
        const dismissOverlay = document.getElementById('dismissOverlay');

        /* ====== state ====== */
        let currentIndex = 0;
        let isPlaying = false;
        let audioEl = null; // background audio element
        let ytPlayer = null; // YouTube player instance (IFrame API)
        let autoplayAttempted = false;

        /* ========= Build list ========== */
        function rebuildList() {
            songListEl.innerHTML = '';
            songs.forEach((s, idx) => {
                const el = document.createElement('div');
                el.className = 'song-item';
                el.dataset.idx = idx;
                el.innerHTML = `
      <div style="width:64px;height:64px;border-radius:8px;overflow:hidden;flex-shrink:0">
        <img src="${s.cover || 'https://picsum.photos/seed/fallback/400/300'}" alt="${s.title}" style="width:100%;height:100%;object-fit:cover">
      </div>
      <div style="flex:1">
        <div style="font-weight:700">${s.title || 'â€”'}</div>
        <div style="font-size:13px;color:var(--muted)">${s.albumTitle ? s.albumTitle + ' Â· ' + s.albumYear : (s.tags || '')}</div>
      </div>
    `;
                el.addEventListener('click', () => loadSong(idx, { userTriggered: true }));
                songListEl.appendChild(el);

                // staggered reveal animation
                setTimeout(() => el.classList.add('visible'), idx * 40);
            });
        }

        /* ======== Load a song ======== */
        function loadSong(i, opts = {}) {
            if (songs.length === 0) return;
            if (i < 0) i = songs.length - 1;
            if (i >= songs.length) i = 0;
            currentIndex = i;
            const s = songs[i];

            // UI updates
            coverImg.src = s.cover || '';
            songTitle.textContent = s.title || 'â€”';
            songTags.textContent = (s.tags ? s.tags + ' Â· ' : '') + (s.albumTitle || '');
            // typewriter effect for desc
            setTypewriterText(songDesc, s.desc || 'â€”');

            // MV: ä½¿ç”¨ YouTube IFrame æˆ–å¡«ç©ºï¼ˆå…ˆæ¸…ç©º containerï¼‰
            setupMV(s.mv);

            // highlight active
            document.querySelectorAll('.song-item').forEach(el => el.classList.remove('active'));
            const active = document.querySelector(`.song-item[data-idx="${i}"]`);
            if (active) active.classList.add('active');

            // audio: è‹¥æ­Œæ›²å®£å‘Šæœ‰ audio å±¬æ€§ï¼Œå‰‡åˆ‡æ› audio source
            if (s.audio) {
                ensureAudioElement();
                if (audioEl.src !== s.audio) {
                    audioEl.src = s.audio;
                    audioEl.load();
                    // è‹¥æ­£åœ¨æ’­æ”¾æˆ–ä½¿ç”¨è€…è§¸ç™¼è‡ªå‹•æ’­æ”¾ï¼Œå˜—è©¦æ’­æ”¾
                    if (isPlaying || opts.userTriggered) {
                        attemptPlayAudio();
                    }
                }
            } else {
                // è‹¥æ²’æœ‰ audio å±¬æ€§ï¼Œä¸è‡ªå‹•æ›¿æ›ï¼Œä¿ç•™ç›®å‰ audio
            }

            // store last index
            try { localStorage.setItem('jj_current', i); } catch (e) { }
        }

        /* Typewriter: é€å­—é¡¯ç¤ºï¼ˆé•·æ–‡ï¼‰ */
        function setTypewriterText(el, text) {
            el.classList.remove('typewriter');
            el.textContent = '';
            // åˆ†æ‰¹é¡¯ç¤º
            let i = 0;
            const speed = 18; // ms per char
            clearInterval(el._twInterval);
            el._twInterval = setInterval(() => {
                i++;
                el.textContent = text.slice(0, i);
                el.classList.add('typewriter');
                if (i >= text.length) {
                    clearInterval(el._twInterval);
                    el.classList.remove('typewriter'); // åœæ­¢æ¸¸æ¨™
                }
            }, speed);
        }

        /* ======== Audio handling ======== */
        function ensureAudioElement() {
            if (!audioEl) {
                audioEl = document.createElement('audio');
                audioEl.id = 'bgAudio';
                audioEl.crossOrigin = 'anonymous';
                audioEl.loop = false;
                audioEl.preload = 'auto';
                audioEl.style.display = 'none';
                document.body.appendChild(audioEl);

                audioEl.addEventListener('play', () => {
                    isPlaying = true; playToggle.textContent = 'æš«åœ';
                });
                audioEl.addEventListener('pause', () => {
                    isPlaying = false; playToggle.textContent = 'æ’­æ”¾';
                });
                audioEl.addEventListener('ended', () => {
                    // é è¨­è¡Œç‚ºï¼šä¸‹ä¸€é¦–
                    loadSong(currentIndex + 1, { userTriggered: false });
                    attemptPlayAudio();
                });

                // é€£å‹• volume slider
                bgVolumeEl.addEventListener('input', () => {
                    audioEl.volume = parseFloat(bgVolumeEl.value);
                });
            }
        }

        /* å¼·åˆ¶å˜—è©¦æ’­æ”¾ï¼ˆå¯èƒ½æœƒè¢«ç€è¦½å™¨é˜»æ“‹ï¼‰ */
        async function attemptPlayAudio() {
            if (!audioEl) return;
            try {
                await audioEl.play();
                isPlaying = true;
                playToggle.textContent = 'æš«åœ';
                // è‹¥æœ‰ YT playerï¼Œä¹Ÿå˜—è©¦æ’­æ”¾
                if (ytPlayer && typeof ytPlayer.playVideo === 'function') {
                    try {
                        ytPlayer.unMute();
                        ytPlayer.playVideo();
                    } catch (e) { }
                }
                playOverlay.style.display = 'none';
            } catch (err) {
                // è¢«é˜»æ“‹ï¼šé¡¯ç¤ºå¤§æŒ‰éˆ•ï¼Œç­‰ä½¿ç”¨è€…äº¤äº’
                console.warn('Autoplay blocked:', err);
                playOverlay.style.display = 'flex';
            }
        }

        /* play/pause toggle */
        playToggle.addEventListener('click', async () => {
            ensureAudioElement();
            if (!audioEl.src && songs[currentIndex] && songs[currentIndex].audio) {
                audioEl.src = songs[currentIndex].audio;
                audioEl.load();
            }
            if (isPlaying) {
                audioEl.pause();
                if (ytPlayer && ytPlayer.pauseVideo) ytPlayer.pauseVideo();
            } else {
                await attemptPlayAudio();
            }
        });

        /* Prev/Next */
        prevBtn.addEventListener('click', () => loadSong(currentIndex - 1, { userTriggered: true }));
        nextBtn.addEventListener('click', () => loadSong(currentIndex + 1, { userTriggered: true }));

        /* Keyboard */
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') prevBtn.click();
            if (e.key === 'ArrowRight') nextBtn.click();
            if (e.key === ' ' && document.activeElement.tagName !== 'INPUT') {
                e.preventDefault();
                playToggle.click();
            }
        });

        /* ======== MV: youtube iframe / setup ======== */
        /* æ–¹æ¡ˆï¼šè‹¥ mv æ˜¯ youtube embed URLï¼Œä½¿ç”¨ IFrame API ä»¥ä¾¿æˆ‘å€‘æ§åˆ¶æ’­æ”¾/éœéŸ³/éŸ³é‡ã€‚ */
        function setupMV(mv) {
            mvPlayerContainer.innerHTML = ''; // reset
            if (!mv) {
                mvPlayerContainer.innerHTML = '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--muted)">æ­¤æ›²ç„¡ MV æˆ–é€£çµã€‚</div>';
                return;
            }
            // è§£æ youtube embed æˆ– watch?v=
            let ytId = null;
            if (mv.includes('youtube.com/embed/')) {
                ytId = mv.split('embed/')[1].split(/[?&]/)[0];
            } else if (mv.includes('youtube.com/watch')) {
                const params = new URLSearchParams(mv.split('?')[1] || '');
                ytId = params.get('v');
            } else if (mv.includes('youtu.be/')) {
                ytId = mv.split('youtu.be/')[1].split(/[?&]/)[0];
            }

            if (ytId) {
                // create iframe for yt
                const iframe = document.createElement('div');
                iframe.id = 'ytPlayer';
                mvPlayerContainer.appendChild(iframe);
                // Create IFrame player (load API if not yet)
                createYouTubePlayer(ytId);
            } else {
                // other embed: just put iframe
                const f = document.createElement('iframe');
                f.src = mv;
                f.style.width = '100%'; f.style.height = '100%'; f.frameBorder = '0';
                f.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                f.allowFullscreen = true;
                mvPlayerContainer.appendChild(f);
            }
        }

        /* Load YouTube IFrame API (only once) and create player */
        let ytApiReady = false;
        let ytCreateQueue = [];
        function loadYouTubeApiOnce() {
            if (window.YT && window.YT.Player) {
                ytApiReady = true; return Promise.resolve();
            }
            return new Promise((resolve, reject) => {
                if (document.getElementById('yt-api')) { // already requested
                    const check = setInterval(() => {
                        if (window.YT && window.YT.Player) { clearInterval(check); ytApiReady = true; resolve(); }
                    }, 200);
                    setTimeout(() => reject(new Error('YT API load timeout')), 8000);
                    return;
                }
                const tag = document.createElement('script');
                tag.id = 'yt-api';
                tag.src = "https://www.youtube.com/iframe_api";
                document.body.appendChild(tag);
                window.onYouTubeIframeAPIReady = () => { ytApiReady = true; resolve(); };
                setTimeout(() => {
                    if (!ytApiReady) { console.warn('YT API load may have failed'); }
                }, 7000);
            });
        }

        async function createYouTubePlayer(ytId) {
            await loadYouTubeApiOnce();
            // remove existing player
            if (ytPlayer && ytPlayer.destroy) { try { ytPlayer.destroy(); } catch (e) { } }
            ytPlayer = new YT.Player('ytPlayer', {
                height: '100%',
                width: '100%',
                videoId: ytId,
                playerVars: {
                    autoplay: 0, controls: 1, rel: 0, modestbranding: 1, playsinline: 1
                },
                events: {
                    onReady: (e) => {
                        // set initial volume
                        e.target.setVolume(Math.round(parseFloat(mvVolumeEl.value) * 100));
                        // if user already asked to play, attempt play
                        if (isPlaying) {
                            try { e.target.playVideo(); e.target.unMute(); } catch (err) { }
                        }
                    },
                    onStateChange: (ev) => {
                        // state sync: if video plays, optionally pause background audio or adjust
                        if (ev.data === YT.PlayerState.PLAYING) {
                            // keep both playing but lower MV volume if needed
                            // we control MV volume via player.setVolume
                        }
                    }
                }
            });
        }

        /* MV / BG volume controls */
        mvVolumeEl.addEventListener('input', () => {
            const v = Math.round(parseFloat(mvVolumeEl.value) * 100);
            if (ytPlayer && ytPlayer.setVolume) ytPlayer.setVolume(v);
        });
        bgVolumeEl.addEventListener('input', () => {
            if (audioEl) audioEl.volume = parseFloat(bgVolumeEl.value);
        });

        /* ======== Attempt auto play on load (may be blocked) ======== */
        window.addEventListener('DOMContentLoaded', async () => {
            rebuildList();
            // restore last index
            const saved = parseInt(localStorage.getItem('jj_current'));
            if (!isNaN(saved)) currentIndex = saved;
            loadSong(currentIndex, { userTriggered: false });
            // attempt to create audio element and autoplay (will likely be blocked until user interacts)
            ensureAudioElement();
            audioEl.volume = parseFloat(bgVolumeEl.value);
            // attempt autoplay once
            try {
                await audioEl.play();
                isPlaying = true;
                playToggle.textContent = 'æš«åœ';
            } catch (err) {
                // blocked -> show overlay prompt
                console.log('autoplay blocked on load:', err);
                playOverlay.style.display = 'flex';
            }

            // show fade-in elements
            document.querySelectorAll('.fade-in').forEach((el, i) => setTimeout(() => el.classList.add('show'), i * 80));

            // add drag scroll for song-list on mobile
            enableTouchScroll(songListEl);
        });

        /* ======== Import / export / utility ======== */
        const importInput = document.getElementById('importInput');
        const importBtn = document.getElementById('importBtn');
        const openImport = document.getElementById('openImport');
        openImport.addEventListener('click', () => importInput.click());
        importBtn.addEventListener('click', () => importInput.click());

        importInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function (ev) {
                const text = ev.target.result;
                try {
                    const j = JSON.parse(text);
                    if (Array.isArray(j)) {
                        // push items
                        j.forEach(item => {
                            songs.push({ ...item });
                        });
                        rebuildList();
                        loadSong(songs.length - j.length, { userTriggered: true });
                        alert('å·²åŒ¯å…¥ ' + j.length + ' é¦–ï¼ˆJSONï¼‰');
                        return;
                    } else {
                        alert('JSON éœ€ç‚ºé™£åˆ—æ ¼å¼ [ {id,title,cover,tags,desc,mv,audio}, ... ]');
                    }
                } catch (err) {
                    // try CSV: åŒä½ åŸæœ¬çš„é‚è¼¯ï¼ˆç°¡æ˜“ï¼‰
                    const lines = text.split(/\r?\n/).filter(Boolean);
                    const header = lines[0].split(',');
                    let parsed = [];
                    if (header.map(h => h.toLowerCase()).includes('title')) {
                        const keys = header.map(h => h.trim().toLowerCase());
                        for (let i = 1; i < lines.length; i++) {
                            const cols = lines[i].split(',');
                            const obj = {};
                            for (let k = 0; k < cols.length; k++) obj[keys[k]] = cols[k] ? cols[k].trim() : '';
                            if (obj.title) parsed.push({ id: obj.id || ('csv_' + i), title: obj.title, cover: obj.cover || '', tags: obj.tags || '', desc: obj.desc || '', mv: obj.mv || '', audio: obj.audio || '' });
                        }
                    } else {
                        for (let i = 0; i < lines.length; i++) {
                            const cols = lines[i].split(',');
                            parsed.push({ id: 'csv_' + i, title: cols[0] || ('track' + i), cover: cols[1] || '', tags: cols[2] || '', desc: cols[3] || '', mv: cols[4] || '', audio: cols[5] || '' });
                        }
                    }
                    if (parsed.length > 0) {
                        parsed.forEach(p => songs.push(p));
                        rebuildList();
                        loadSong(songs.length - parsed.length, { userTriggered: true });
                        alert('å·²åŒ¯å…¥ ' + parsed.length + ' é¦–ï¼ˆCSVï¼‰');
                    } else {
                        alert('åŒ¯å…¥å¤±æ•—ï¼šç„¡æ³•è¾¨è­˜æª”æ¡ˆå…§å®¹æˆ–æ ¼å¼ã€‚');
                    }
                }
            };
            reader.readAsText(file, 'utf-8');
        });

        /* add sample (å¤§é‡) */
        document.getElementById('addSampleBtn').addEventListener('click', () => {
            const count = 20;
            for (let i = 0; i < count; i++) {
                songs.push({
                    id: 'sample_' + Date.now() + '_' + i,
                    title: 'æ›´å¤šæ›²ç›® ' + (i + 1),
                    cover: 'https://picsum.photos/seed/more' + i + '/600/400',
                    tags: 'ç¤ºç¯„ Â· 2024',
                    desc: 'é€™æ˜¯å¤§é‡åŒ¯å…¥çš„ç¤ºç¯„æ›²ç›®ï¼Œç”¨ä¾†é¡¯ç¤ºç³»çµ±èƒ½ä¸€æ¬¡è¼‰å…¥å¾ˆå¤šé¦–æ­Œã€‚',
                    mv: '',
                    audio: ''
                });
            }
            rebuildList();
            loadSong(songs.length - count, { userTriggered: false });
        });

        /* clear */
        document.getElementById('clearBtn').addEventListener('click', () => {
            if (!confirm('ç¢ºå®šè¦æ¸…ç©ºæ­Œå–®å—ï¼Ÿ')) return;
            songs = [];
            rebuildList();
            coverImg.src = '';
            songTitle.textContent = 'â€”';
            songDesc.textContent = 'æ­Œå–®å·²æ¸…ç©º';
        });

        /* Download site snapshot */
        document.getElementById('downloadSite').addEventListener('click', () => {
            const html = '<!doctype html>\\n' + document.documentElement.outerHTML;
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = 'jay_site_snapshot.html';
            document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        });

        /* Play overlay handlers */
        startAll.addEventListener('click', async () => {
            playOverlay.style.display = 'none';
            ensureAudioElement();
            // if current song has audio and audioEl not set, set
            const s = songs[currentIndex];
            if (s && s.audio && !audioEl.src) {
                audioEl.src = s.audio; audioEl.load();
            }
            try { await attemptPlayAudio(); } catch (e) { console.warn(e); }
        });
        dismissOverlay.addEventListener('click', () => { playOverlay.style.display = 'none'; });

        /* Theme toggle */
        const themeBtn = document.getElementById('themeBtn');
        function setTheme(t) { document.documentElement.setAttribute('data-theme', t); themeBtn.textContent = t === 'light' ? 'â˜€ï¸' : 'ğŸŒ™'; try { localStorage.setItem('jj_theme', t); } catch (e) { } }
        themeBtn.addEventListener('click', () => {
            const cur = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
            setTheme(cur);
        });
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('jj_theme') || 'dark';
            setTheme(savedTheme);
        });

        /* Utility: allow touch drag scroll for a container */
        function enableTouchScroll(el) {
            let isDown = false, startX, scrollLeft;
            el.addEventListener('touchstart', (e) => {
                isDown = true; startX = e.touches[0].pageX - el.offsetLeft; scrollLeft = el.scrollLeft;
            });
            el.addEventListener('touchmove', (e) => {
                if (!isDown) return;
                const x = e.touches[0].pageX - el.offsetLeft;
                const walk = (x - startX);
                el.scrollLeft = scrollLeft - walk;
            });
            el.addEventListener('touchend', () => isDown = false);
        }

        /* Small accessibility: focus first on list after build */
        songListEl.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const t = e.target.closest('.song-item');
                if (t) loadSong(parseInt(t.dataset.idx), { userTriggered: true });
            }
        });

        /* END */
    </script>
</body>

</html>